<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Konverter.ai Voice</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./styles_v2.css">
    
    <!-- Google Conversational Agent Styles -->
    <link rel="stylesheet" href="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/themes/df-messenger-default.css">
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1 class="title">Konverter.ai Voice</h1>
            <p class="subtitle">Premium AI voice conversation</p>
            <div class="status" id="status">Ready to chat!</div>
            <button class="debug-button" id="debugBtn" onclick="showDebugInfo()">üõ†Ô∏è</button>
        </div>
        
        <!-- Main interaction options -->
        <div class="interaction-options">
            <div class="option-card" onclick="openGoogleAgent()">
                <div class="option-icon">ü§ñ</div>
                <h3>Chat with Konverter AI</h3>
                <p>Ask about our AI agent marketplace, funding, or get a demo</p>
                <button class="option-button">Start Conversation</button>
            </div>
            
            <div class="option-card" onclick="showVoiceInterface()">
                <div class="option-icon">üé§</div>
                <h3>Voice Interface (Beta)</h3>
                <p>Test our advanced voice conversation technology</p>
                <button class="option-button">Try Voice Mode</button>
            </div>
        </div>
        
        <!-- Voice interaction (initially hidden) -->
        <div class="voice-interaction" id="voiceInterface" style="display: none;">
            <div class="circles-container">
                <!-- User Circle -->
                <div class="circle user-circle" id="userCircle">
                    <div class="wave user-wave wave-1"></div>
                    <div class="wave user-wave wave-2"></div>
                    <div class="wave user-wave wave-3"></div>
                    <div class="circle-icon">üë§</div>
                    <div class="circle-label">You</div>
                </div>
                
                <!-- AI Circle -->
                <div class="circle ai-circle" id="aiCircle">
                    <div class="wave ai-wave wave-1"></div>
                    <div class="wave ai-wave wave-2"></div>
                    <div class="wave ai-wave wave-3"></div>
                    <div class="circle-icon">ü§ñ</div>
                    <div class="circle-label">AI</div>
                </div>
            </div>
            
            <!-- Live transcription -->
            <div class="live-transcription">
                <div class="transcription" id="inputTranscription"></div>
                <div class="transcription" id="outputTranscription"></div>
            </div>
            
            <!-- Controls -->
            <button class="mic-button" id="micButton" disabled>üé§</button>
            <button class="back-button" onclick="showMainInterface()">‚Üê Back to Chat</button>
        </div>
        
        <div class="session-info" id="sessionInfo">
            Session: Ready
        </div>
        
        <div class="loading-spinner" id="loadingSpinner" style="display: none;"></div>
    </div>

    <!-- Google Conversational Agent -->
    <script src="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/df-messenger.js"></script>
    <df-messenger
      project-id="n8n-lomeai"
      agent-id="7bd4b98d-e56b-448d-914b-06be3a0f5f0c"
      language-code="en"
      max-query-length="-1"
      allow-feedback="all"
      id="konverterAgent">
      <df-messenger-chat-bubble
        chat-title="Konverter.ai Assistant">
      </df-messenger-chat-bubble>
    </df-messenger>

    <!-- Load existing scripts -->
    <script src="./ui_controller_v2.js"></script>
    
    <script type="text/javascript">
        // Enhanced interface controls
        function openGoogleAgent() {
            // Programmatically open the Google agent chat
            const messenger = document.querySelector('df-messenger');
            if (messenger) {
                // This will open the chat interface
                messenger.renderCustomText({text: 'Hello! I\'m interested in learning about Konverter.ai'});
                // Expand the chat if it's minimized
                const chatBubble = messenger.querySelector('df-messenger-chat-bubble');
                if (chatBubble) {
                    chatBubble.click();
                }
            }
        }
        
        function showVoiceInterface() {
            document.querySelector('.interaction-options').style.display = 'none';
            document.getElementById('voiceInterface').style.display = 'block';
            // Initialize voice interface if needed
            initializeVoiceMode();
        }
        
        function showMainInterface() {
            document.querySelector('.interaction-options').style.display = 'block';
            document.getElementById('voiceInterface').style.display = 'none';
        }
        
        async function initializeVoiceMode() {
            // Your existing voice initialization code
            try {
                document.getElementById('status').textContent = 'Voice mode ready!';
                // Add your voice initialization logic here
            } catch (error) {
                console.error('Voice initialization failed:', error);
                document.getElementById('status').textContent = 'Voice mode unavailable';
            }
        }
        
        // Debug functions
        function showDebugInfo() {
            const debugInfo = {
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                telegramAvailable: typeof window.Telegram !== 'undefined',
                googleAgentLoaded: !!document.querySelector('df-messenger'),
                location: window.location.href
            };
            
            alert('Debug Info:\n' + JSON.stringify(debugInfo, null, 2));
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('status').textContent = 'Ready to chat!';
            
            // Add event listeners for Google agent
            const messenger = document.querySelector('df-messenger');
            if (messenger) {
                messenger.addEventListener('df-messenger-loaded', function() {
                    console.log('Google Conversational Agent loaded successfully');
                });
                
                messenger.addEventListener('df-user-input-entered', function(event) {
                    console.log('User input:', event.detail.input);
                    // You can track user interactions here for analytics
                });
                
                messenger.addEventListener('df-response-received', function(event) {
                    console.log('Agent response:', event.detail.response);
                    // Track agent responses for analytics
                });
            }
        });
    </script>

    <style>
        /* Enhanced styles for the new interface */
        .interaction-options {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 20px;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .option-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 24px;
            color: white;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            text-align: center;
        }
        
        .option-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
        }
        
        .option-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        .option-card h3 {
            margin: 0 0 12px 0;
            font-size: 20px;
            font-weight: 600;
        }
        
        .option-card p {
            margin: 0 0 20px 0;
            opacity: 0.9;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .option-button {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .option-button:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
        }
        
        .back-button {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            margin-top: 20px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .back-button:hover {
            background: #5a6268;
        }
        
        /* Google Conversational Agent Styling */
        df-messenger {
            z-index: 999;
            position: fixed;
            --df-messenger-font-color: #000;
            --df-messenger-font-family: 'Inter', sans-serif;
            --df-messenger-chat-background: #f8f9fa;
            --df-messenger-message-user-background: #667eea;
            --df-messenger-message-bot-background: #fff;
            --df-messenger-bot-message: #333;
            --df-messenger-user-message: #fff;
            bottom: 20px;
            right: 20px;
            --df-messenger-chat-border-radius: 16px;
            --df-messenger-chat-bubble-background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        /* Hide Google agent initially if you want manual control */
        df-messenger {
            display: block;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .interaction-options {
                padding: 16px;
            }
            
            .option-card {
                padding: 20px;
            }
            
            df-messenger {
                bottom: 16px;
                right: 16px;
            }
        }
    </style>
</body>
</html>
